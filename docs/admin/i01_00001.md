---
title: 有度客户端登录逻辑
description: 本文主要介绍涉及客户端登录的连接方式和客户端登录逻辑，并进行详细说明。
keywords: 服务器连接，客户端，登录逻辑
---

#### 1.服务器连接方式

在登录有度客户端进行使用之前，需要进行服务器设置；有度服务器连接包括【通过总机号连接】和【通过服务器地址连接】两种方式：

##### 1.1.通过总机号连接

总机号是有度为每一个企业分配的唯一ID；在企业启用有度之前，可以将本地有度服务器的地址（IP地址或域名）注册到有度的公有基础服务—DNS服务中（该服务向所有企业客户提供服务器地址中转服务）；注册完成后，在有度的DNS服务中将按【总机号—服务器地址】这样的对应关系记录企业客户的服务器地址。

有度客户端配置服务器为【通过总机号连接】，用户登录时，首先通过总机号，向有度的DNS服务换取企业本地的服务器地址，然后通过服务器地址完成登录。	

##### 1.2.通过服务器地址连接

有度客户端配置服务器为【通过服务器地址连接】，并输入有度本地服务器的地址（IP地址或域名），登录的时候直接通过服务器地址完成登录。

#### 2.客户端登录逻辑

##### 2.1.电脑端登录

电脑端与服务器是TCP长连接方式连通，一旦登录成功，该连接就一直存在；当用户注销、断网、账号在其他地方登录而被踢下线时，该连接才会断开，然后账号处于电脑端离线状态。

###### 2.1.1.主动登录

主动登录是指用户通过输入账号密码、短信验证码，或者用有度手机端APP扫码电脑端的登录二维码完成登录的过程。

每次完成主动登录后，有度服务端会生成一个reloginkey和一个用户token，保存在服务器数据库中，同时下发给客户端；reloginkey用于电脑端的自动登录验证，token用于客户端与服务端进行数据交互时进行身份验证。

reloginkey，token的有效期都是1个月。

###### 2.1.2.自动登录

主动登录的时候如果勾选上【自动登录】，则下次打开有度电脑客户端时将自动完成登录。

自动登录时，客户端将reloginkey上传到服务端进行验证，如果reloginkey与用户身份一致且在有效期内，则验证通过；如果不一致或reloginkey失效，则提示客户端重新进行主动登录。

验证通过后，有度服务会自动将reloginkey的有效期重置，有效期依然保持为1个月。

##### 2.2.手机端登录

客户端登录服务器包括【主动登录】和【自动重连】两种情况：

##### 2.2.1.主动登录

主动登录是指用户手工输入账号、密码，或者短信验证码，然后点击登录按钮进行主动登录的情况，包括首次使用时登录、注销账号登录。登录过程：

-优先使用服务器内网地址进行登录尝试。

-内网地址登录超时（2秒）后，再用外网地址尝试登录。

-如果两个地址都登录失败，则提示用户登录不成功，然后不再尝试登录，等待用户调整参数配置后再发起主动登录动作。

##### 2.2.2.自动重连

在断网恢复、切换网络（比如内外网切换）、APP从后台切换到前台的时候，系统会自动尝试重新登录；此时因为不是用户主动退出登录，所以系统会一直尝试重新登录，直到网络恢复并登录成功；登录过程：

-优先用内网地址登录，内网地址登录超时（2秒）后，再用外网地址尝试登录。

-如果外网地址登录也不成功，会延迟3秒后再重试前述过程。

-如果3秒后重试依然不成功，系统会持续重试登录，直到成功。

-每次重试之间的间隔会增加3秒，比如第一次间隔3秒，第二次间隔6秒，直到间隔10分钟，然后以10分钟一次的频率不断尝试登录，直到登录成功。

-这个逻辑主要解决断网自动重连的问题，每次拉长时间间隔是考虑省电。

#### 3.短信码二次验证

为了防止用户账号、密码被盗时被他人非法登录，可以在有度管理后台设置用户登录时进行短信码二次验证。

##### **3.1.设置入口**

可以通过【有度管理后台—我的企业—安全管理—登录短信验证】来打开或关闭短信码二次验证。

##### **3.2.验证方式**

-不开启短信验证（缺省）：登录有度客户端时，不用进行短信二次验证。

-每次登录均需要：每次登录有度客户端时，都需要进行短信二次验证。

-新设备首次登录需要：只有在更换设备并首次登录时，需要进行短信二次验证。

##### **3.3.验证设备**

支持选择对所有客户端、仅移动客户端（各类手机）、仅桌面客户端（各类台式机）进行指定短信验证。